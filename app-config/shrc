# -*- mode: sh -*-
# ~/.zshrc ~/.bash_login

# places
if [[ $(uname -o) == Msys ]]; then
    mount=/h
else
    mount=~
fi
h=$mount/Public/hdhoang
conf=$h/system-config/$(hostname)
box=$mount/Box
dbox=$mount/DropBox
t=$mount/t
dl=$mount/Downloads
m=$mount/Music/_new
p=$mount/Pictures
v=$mount/Videos
mi=$mount/Public/mirror
g=$mount/g
s=$dbox/runnable
fm=$mount/Music

# utils
alias g='git'
alias gp='g pr | grep "up to date" || g ml'
alias x=parallel
alias e='"$EDITOR" -n'
function getc() {
    cd ${1:-.}
    $v/_youtube-dl || \
    wget --continue
}
alias nn='nice ionice -c 3 '

# local info
alias ls='ls --color=auto --file-type'
alias df='df -hT --total -x tmpfs -x devtmpfs'
alias du='du -h --total'
alias p='pgrep -f'
alias fr='free -h | awk "NR==2 {print \$4}"'
alias t='less -F'
alias j='journalctl -afb'

# network info
alias dnsip='dig +short myip.opendns.com @resolver1.opendns.com'
alias np='sudo tcpdump -w - | pv -bert >/dev/null'

# file ops
function cd() {
    if [[ $# -eq 0 ]]; then ~; fi
    if [[ -d $1 ]]; then
        builtin cd $1
    else
        [[ ! -e ${1%/*} ]] && return 1
        builtin cd ${1%/*}
    fi
}
alias ...='cd ../../'
alias mkdir='mkdir -p'
alias cp='cp -r --reflink=auto --preserve=xattr'
alias ln='ln -i'
alias mv='mv -i'
alias rm='rm --interactive=once --one-file-system'
alias prv='perl-rename -iv'
alias rs='nn rsync --human-readable --verbose --progress --partial --archive --no-group'

# system
alias ssc='sudo systemctl --system'
alias usc='systemctl --user'
alias mp='nn makepkg -isf'
alias i='sudo pacman'
alias pc='pacman -Qdt && i -R $(pacman -Qdtq)'
alias cower='cower -fddt $ap'
pkg=/var/cache/pacman/pkg
ap=$mount/archlinux
function aur {
    cd $ap
    cower $1 || curl -o- https://aur.archlinux.org/packages/${1:0:2}/$1/$1.tar.gz | tar zxv
    cd $1
    mp ${*:2}
}

if [ -n "$BASH" ]; then
    shopt -s histverify histappend
    shopt -s extglob nocaseglob globstar
    shopt -s autocd

    alias which=type
fi

if [ -n "$ZSH_NAME" ]; then
    setopt autocd
    HISTSIZE=SAVEHIST=1000; HISTFILE=~/.zsh_history
    setopt inc_append_history noclobber HIST_ALLOW_CLOBBER HIST_REDUCE_BLANKS
    setopt INTERACTIVE_COMMENTS LOCAL_OPTIONS
    unsetopt AUTO_NAME_DIRS bash_auto_list
    autoload select-word-style && select-word-style BASH # with CamelCase support
    zstyle ':vcs_info:*' enable git

    PROMPT="%m %~ %w %(?..%? )
%# "

    setopt dvorak
fi

if [[ $(uname -o) == Cygwin ]]; then
    . $h/app-config/env
    export $(cut -s -d= -f1 $h/app-config/env)
    alias nn='nice '
fi

if [[ $(uname) == Darwin ]]; then
    export PATH=$PATH:~/brew/bin
    awk -F = '/=/{ print $1 " " $2 }' $h/app-config/env | xargs -L 1 launchctl setenv

    export CLICOLOR
    alias ls='ls -GT'
    unalias rm
fi
