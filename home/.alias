#!/bin/bash

# utils
alias g='git'
alias gp='g pr | grep "up to date" || g ml'
alias mg='magit -e'
function day() {
    grep $(date --rfc-3339=date -d "${1:-0} days ago") ${*:2}
}
alias x=parallel
alias e="emacsclient -n"
alias f='firefox'
alias rcmd="wget -qO - http://www.commandlinefu.com/commands/random/plaintext"
function getc() {
    cd $1
    if [[ "$2" == "-e" ]]; then
        e q.txt
        python2 ~/Videos/youtube-dl/youtube-dl
    elif [[ "$PWD" == */Videos* || "$PWD" == */p ]]; then
    elif [[ "$PWD" == */lastfm ]]; then
        wget -c --content-disposition -i q.txt
    else
        wget -c -i q.txt
    fi
}
alias nn='chrt -i 0 ionice -c 3 '

# places
h=~/Public/hdhoang-misc
conf=$h/system-config/$(hostname)
t=~/t
dl=~/Downloads
m=~/Music
p=~/Pictures
v=~/Videos
g=/mnt/cenbaz/@g
s=/mnt/cenbaz/@s
pkg=/var/cache/pacman/pkg
el=/var/log/everything.log

fav=~/Public/fav
fm=$fav/Music
pool=/mnt/marbi

# local info
alias ls='ls --color=auto --file-type --group-directories-first'
alias df='df -hT --total -x tmpfs -x devtmpfs -x rootfs'
alias du='du -h --total'
alias dumx='dumx -h -xdev'
alias locate='locate -ie'
alias p='pgrep -f'
alias who='who -aH'
alias s='watch "cpupower -c all frequency-info -mf; cpupower -c all frequency-info -ms; grep current /sys/kernel/debug/dri/0/radeon_pm_info; sensors | grep -v fan"'
alias fr='free -m'
alias t='tail -f'

# network info
alias nh='sudo nethogs'
port_mapping=(
587 tcp 465 tcp # tor
25 tcp # exim
80 tcp 443 tcp # lighttpd
)
alias op='upnpc -r ${port_mapping[*]}'

# file ops
alias mkdir='mkdir -p'
alias cp='cp -r --reflink=auto --preserve=xattr'
alias ln='ln -i'
alias mv='mv -i'
alias rmdir='rmdir -p'
alias rm='rm --interactive=once --one-file-system'
alias prv='perl-rename -iv'
function xattr() {
        setfattr -n "user.$USER.$1" -v "$2" "${@:3}"
}
alias com='x 7z -o$HOME/Public/mirror/ x {} ::: {$dl,/mnt/cenbaz/@d}/*{rar,zip}'
alias rs='nn rsync --human-readable --verbose --progress --partial --archive --xattrs'
alias bu='rs --delete --exclude=sumatrapdfcache/ /mnt/cenbaz/@{s,g} ~/s $h $p ~/Public/pic ~/Public/mirror/{book,systemd-arch-units} $m $v $pool'

# system
alias ssc='sudo systemctl --system'
alias usc='systemctl --user'
alias po='cat ~/shutdown-todo.txt - && ssc'
alias psc='ps xawf -eo pid,user,cgroup,args'
function sls() {
    x -X systemd-cgls systemd:/system/{}.service ::: $*
}

alias mp='nn makepkg -isf'
alias i='sudo pacmatic'
alias pc='pacman -Qdt && i -R $(pacman -Qdtq)'
alias cower='cower -fddt $ap'
ap=~/archlinux
function aur {
    cd $ap
    cower $1 || curl https://aur.archlinux.org/packages/$1/$1.tar.gz | tar zxv
    cd $1
    mp ${*:2}
}

# fun
alias c="crawl-tiles&"
alias m='mplayer'
alias mi=mediainfo
alias ti=gtorrentviewer
alias rb='wget -N http://build.rockbox.org/data/rockbox-ipodnano1g.zip -P ~/Public/mirror && 7z -y -o/mnt/roxer x ~/Public/mirror/rockbox-ipodnano1g.zip'
alias dum='dumx -v $m -type d|cut -c 9-|x -kX ls -1'
alias favd='ls $fm/*/* | grep -o "[^/]*_@_[^[]*" | uniq -di'
alias fava='ls $fm/*/* | grep -o "[^/]*_@" | uniq -c | sort -n'
alias favl='ls $fm/*/* | grep -o "\[.*\]" | sort | uniq -c | sort -n'
alias favs='xattr fav fav $fav/**/*; rs --delete $fav $pool'
alias favf='rm -rf /mnt/roxer/m/ && cd $fm && ls */* | shuf -n 100 | rs --files-from=- --no-xattrs $fm /mnt/roxer/m/'
function favm() {
    # not using alias to keep emacs hili sane
    cd $fm
    rm -f **/*jpg
    prv "tr/ /_/;
         s/^''/_/;s/''/-/g;
         tr/\"*:<>/-/;s/\?//g;
         s/_\[Unknown_Album\]//i;s/\[unknown\]/(unknown)/;s/\[dialogue\]/(dialogue)/;s/\[untitled\]/(untitled)/" *
}
