#!/bin/bash

# utils
PATH=$PATH:~/Public/mirror/git-achievements
alias g='git-achievements'
alias gp='g pr && g ml'
function day() {
    grep $(date --rfc-3339=date -d "${1:-0} days ago") ${*:2}
}
alias x=parallel
alias e="emacsclient -n"
alias f='firefox'
alias rcmd="wget -qO - http://www.commandlinefu.com/commands/random/plaintext"
alias getc='wget -ci ~/get-queue -P $dl'
alias gete='e ~/get-queue'
alias nn='nice -n 19 ionice -c 3 '

# places
h=~/Public/hdhoang-misc
conf=$h/system-config/$(hostname -s)
t=~/t
dl=~/Downloads
g=/mnt/cmaluz/@g
pkg=/var/cache/pacman/pkg
el=/var/log/messages

f=~/Public/fav
pool=/mnt/marbi

# local info
alias ls='ls --color=auto --file-type --group-directories-first'
alias df='df -hT --total -x tmpfs -x devtmpfs -x rootfs'
alias du='du -h --total'
alias dumx='dumx -h -xdev'
alias locate='locate -ie'
alias p='pgrep -f'
alias who='who -aH'
alias s=sensors
alias t='inotail -f'

# network info
alias whois='gwhois'
alias nh='sudo nethogs'
port_mapping=(
587 tcp 465 tcp # tor
25 tcp # exim
80 tcp 443 tcp # lighttpd
)
alias op='upnpc -r ${port_mapping[*]}'

# file ops
alias mkdir='mkdir -p'
alias cp='cp -r --reflink=auto --preserve=xattr'
alias ln='ln -i'
alias rmdir='rmdir -p'
alias rm='rm --interactive=once --one-file-system'
alias prv='perl-rename -iv'
function xattr() {
	local label="$1"
	shift
	local value="$1"
	shift
	setfattr -n "user.$USER.$label" -v "$value" "$@"
}
function com() {
    prv 's/rar$/cbr/;s/zip$/cbz/' {$dl,/mnt/cmaluz/@d}/*
    mv {$dl,/mnt/cmaluz/@d}/*cb? ~/Public/mirror/
}
alias rs='nn rsync --human-readable --verbose --progress --partial --archive --xattrs'
alias bu='rs --delete --exclude="FirefoxPortableNightly/Data/profile/Cache" /mnt/cmaluz/@{s,g} ~/{Music,Pictures} $h ~/Public/{openid,pic} ~/Public/mirror/book $pool'

# system
alias ssc='sudo systemctl --system'
alias usc='systemctl --user'
alias po='cat ~/shutdown-todo.txt - && ssc'
alias psc='ps xawf -eo pid,user,cgroup,args'
function sls() {
    x -X systemd-cgls systemd:/system/{}.service ::: $*
}

alias mp='nn makepkg -isf'
alias i='sudo pacman'
alias cower='cower -fddt $ap'
ap=~/archlinux
function aur {
    cd $ap
    cower $1
    cd $1
    shift
    mp $*
}

# fun
alias gd="export LIBGL_DRIVERS_PATH=/usr/lib/xorg/modules/dri_g/"
alias c="crawl-tiles&"
alias m='mplayer'
alias rb='wget -N http://build.rockbox.org/data/rockbox-ipodnano1g.zip -P ~/Public/mirror && unzip ~/Public/mirror/rockbox-ipodnano1g.zip -d /mnt/roxer'
alias dum=' dumx -v ~/Music -type d|cut -c 9-|x -kX ls -1'
alias favd='ls -1 $f/Music |awk "{FS=\"_\\\[\"; print \$1}" | uniq -d'
alias fava='ls -1 $f/Music |awk "{FS=\"_-_\"; print \$1}" | uniq -c | sort -n'
alias favl='ls -1 $f/Music |awk "{FS=\"\\\[|\\\]\"; print \$2}" | sort | uniq -c | sort -n'
alias favs='xattr fav fav $f/**/*; rs --delete $f $pool'
